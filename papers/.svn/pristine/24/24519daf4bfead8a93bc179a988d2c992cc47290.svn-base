%-------------------------------------------------------------------------------
% COMUNICAÇÃO E LOCALIZAÇÃO DOS SERVIDORES  
%-------------------------------------------------------------------------------
\section{Comunicação e Localização dos Servidores}

A comunicação entre clientes e servidores, bem como entre os próprios servidores está baseada no conceito de {\port} \cite{acc86}. Quando um processo deseja se comunicar com outros ele cria um ou mais {\ports} que serão usados para receber e enviar mensagens. Desta forma, a entidade identificada na comunicação é o {\port} e não o processo que o criou. 

O uso de {\ports} para a comunicação entre processos permite que se defina um espaço "bem conhecido" de {\ports}, de forma similar aos WKS ({\em Well Known Services}) da {\inet} \cite{sun92}. Esse conjunto engloba todos os serviços básicos do sistema, de tal forma que, quando um cliente deseje um serviço, ele conheça, a priori, o {\port} correspondente. Da maneira como os WKS são implementados na {\inet}, se um dado serviço está disponível em um {\host}, então o respectivo servidor também está disponível naquele {\host}. Essa é uma restrição que contraria as metas definidas para o projeto, pois não permite que os servidores do {\sdfs} executem em {\hosts} distintos. Decidiu-se então expandir este mecanismo para que um {\port} local possa estar associado a um servidor remoto. 

Na primeira versão do {\sdfs} o sistema de comunicação incluiu uma tabela de localização com uma entrada para cada "serviço bem conhecido". Cada entrada da tabela identifica até três servidores aptos a executar os serviços associados ao respectivo {\port}. Quando um cliente solicita um serviço, ele o faz enviando uma mensagem a um {\port}. Para proceder a entrega da mensagem, o sistema de comunicação consulta a tabela de localização em busca de um par ({\host}, {\port}) que identifica globalmente um servidor. Caso as três referências da tabela sejam nulas, uma mensagem indicando a indisponibilidade do serviço é retornada ao cliente. Caso alguma das entradas seja válida, o sistema de comunicação procederá ao envio da mensagem ao primeiro {\port} indicado na tabela. Cada servidor tem associado um tempo máximo de execução do serviço, e assim, o sistema de comunicação pode, decorrido o limite de tempo sem que se tenha recebido uma resposta do servidor, proceder ao envio da mensagem ao próximo servidor da lista. Um exemplo de tabela de localização de servidores pode ser visto na tabela \ref{tls}.

\begin {table} [htbp]
\sf
\begin {center}
\begin {tabular} {|c|c|c|c|}
\hline
  & SERVIDOR 0 & SERVIDOR 1 & SERVIDOR 2\\
\hline

\begin {tabular} {c}
  Serviço\\
\hline
  0\\
  1\\
  2\\
  :\\
  n\\
\end {tabular} &

\begin {tabular} {c|c|c}
  Host & Port & Tmp\\
\hline
  local & 0 & 5\\
  local & 1 & 5\\
  vega  & 2 & 80\\
  :     & : & :\\
  local & n & 5\\
\end {tabular} &

\begin {tabular} {c|c|c}
  Host & Port & Tmp\\
\hline
  local & 4 & 5\\
  vega  & 1 & 50\\
  -     & - & -\\
  :     & : & :\\
  vega  & n & 50\\
\end {tabular} &

\begin {tabular} {c|c|c}
  Host & Port & Tmp\\
\hline
  -    & - & -\\
  juno & 8 & 100\\
  -    & - & -\\
  :    & : & :\\
  baco & n & 60\\
\end {tabular} \\
\hline
\end {tabular}
\end {center}
\caption {Tabela de localização de servidores}
\label {tls}
\end {table}

O mecanismo de localização de servidores descrito permite a replicação de servidores, uma vez que eles são idempotentes, bem como a definição de serviços equivalentes, pois um {\port} pode ser redirecionado para outro no mesmo {\host}. A tabela de localização de servidores pode ser alterada por meio de chamadas ao núcleo do sistema operacional, permitindo que, futuramente, um servidor externo faça reconfigurações dinâmicas na tabela, otimizando o tempo de resposta dos serviços.

A tabela de localização de servidores permite que um cliente localize um servidor de forma transparente, porém, o próprio sistema de arquivos está dividido em mais de um servidor, sendo necessário definir-se um mecanismo para que os servidores se localizem entre si. Como o {\sdfs} não permite a replicação transparente de arquivos, definiu-se que sempre que um {\host} contiver um arquivo, ele conterá também toda a coleção de servidores correspondentes ao arquivo. Desta forma, pode-se tirar do próprio identificador do arquivo a informação sobre a localização dos servidores, ou seja, assim que o servidor de diretórios obtém o identificador de um arquivo, as mensagens relativas a ele passam a ser enviadas diretamente ao {\host} que o contém.

Um caso especial ocorre quando temos cada um dos servidores do {\sdfs} executando em um processador particular de um multiprocessador. Neste caso, o multicomputador é visto como um único {\host}, sendo que o espaço de "serviços bem conhecidos" é distribuído pelos processadores. O núcleo do sistema operacional ou o controlador de comunicações é responsável por dizer qual {\port} pertence a qual processador.

Para manter a interface do sistema de comunicações homogênea, todo o endereçamento de mensagens compreende o par ({\host}, {\port}), sendo que quando o campo {\host} for nulo, o sistema tentará definí-lo através de uma pesquisa na tabela de localização de servidores.


