%-------------------------------------------------------------------------------
% AUTENTICAÇÃO DE MENSAGENS
%-------------------------------------------------------------------------------
\section{Autenticação de Mensagens}

Um problema grave no que diz respeito à segurança de sistemas distribuídos é a autenticação das mensagens de solicitação de serviço. No caso do {\sdfs}, os servidores não guardam informações sobre o estado dos cliente, agravando bastante esse problema. Todas as mensagens enviadas aos servidores do sistema de arquivos contém o identificador do arquivo a ser operado. Sem um mecanismo seguro, os servidores não poderiam dizer se o identificador de arquivo foi obtido do servidor de diretórios com o respectivo serviço ou se ele foi arbitrado por um cliente descuidado ou mal intencionado.

Para autenticar uma mensagem, o {\sdfs} faz uso de uma chave gerada pelo servidor de diretórios em resposta à solicitação de um serviço especial. Por ser idenpotente, o {\sdfs} não implementa um serviço "open" convencional, resumindo esse serviço a obtenção do descritor de arquivo e da respectiva chave. Para solicitar qualquer outro serviço, o cliente deve apresentar o identificador do arquivo juntamente com a chave, que será usada para validar a solicitação. A chave é gerada como função do próprio identificador do arquivo, da data de criação do arquivo e do identificador do usuário.

A inclusão da data de criação do arquivo na composição da chave de autenticação se deu pelo fato dos servidores do sistema de arquivos não manterem uma tabela de arquivos abertos, mas sim uma {\cache} com os descritores dos arquivos mais recentemente acessados. Assim, um cliente pode obter o identificador de um arquivo e a respectiva chave e ficar algum tempo sem acessar o arquivo, de forma que seu descritor seja removido da {\cache}. Um outro cliente pode agora solicitar a remoção deste arquivo. É matematicamente possível que um outro arquivo venha a ser criado e receba o mesmo identificador. Aquele primeiro cliente que obteve o identificador do arquivo passará a acessar, indevidamente, um novo arquivo. Incluindo a data da criação do arquivo na função geradora da chave elimina-se esse problema.

O identificador do usuário foi envolvido na geração da chave de autenticação para evitar que um usuário abra um arquivo, obtenha o seu identificador e a chave, e transfira autorizações de acesso a um outro usuário originalmente não autorizado. Considere um exemplo onde as autorizações de um arquivo permitam sua leitura por qualquer usuário do grupo do dono do arquivo, mas não pelos demais usuários. Um processo de um usuário do grupo do dono (cliente) poderia abrir o arquivo e mandar uma mensagem contendo o identificador e a chave a um processo de um usuário de fora do grupo do dono do arquivo, desvirtuando o esquema de controle de acesso aos arquivos.

