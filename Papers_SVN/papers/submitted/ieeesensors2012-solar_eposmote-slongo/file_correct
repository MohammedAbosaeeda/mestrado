Embedded System Energy Scheduler Improvement Through a Solar Energy Harvesting Circuit

Leonardo Kessler Slongo, Arliones Hoeller Jr, and Antˆonio Augusto Fr¨ohlich,

Federal University of Santa Catarina

Abstract—This work presents a solar energy harvesting circuit
envisioned to extend the lifetime of a specific embedded system
named EPOSMoteII. The purposed circuit is able to operate
a 4V-100mA solar panel closely to its maximum power point
(MPP) only by a good matching between the battery and the
solar panel. The paper discusses the circuit design and evaluation,
proving its near-perpetual operation behavior. Besides that, the
work provided ways for a reformulation of EPOSMoteII energy
scheduler by delivering to it more accurate battery information.
Index Terms—Energy harvesting, energy scheduler, EPOSMoteII,
solar panel, wireless sensor networks.

I. INTRODUCTION
ENERGY consumption is a determining factor when designing
a wireless sensor network. The battery’s lifetime
is a limiter on the development of a quasi-self-sufficient
system. Therefore, the idea of extracting energy from the
environment has become an interesting field of scientific
research. Among many environmental sources of energy which
have been studied so far, the solar one has proved to be one of
the most efficient [1]. Solar energy is converted by solar cells,
which present an optimum operating voltage. Operating a solar
panel on this voltage implies in transferring to the system
the maximum amount of power available. In this context,
maximum power point tracker circuits (MPPT) are being
developed. It is known that a MPPT circuit may introduce
losses to a solar harvesting system. Concerning low-power
applications, it may be more energy efficient to have a good
match between the solar panel and the energy storage unit [2].
This well matched system is than able to work close to the
maximum power point with less power losses.
Looking to the energy consumption problem from another
point of view, the intelligent usage of the stored energy
contributes to extend the sensor’s node longevity. Therefore,
energy schedulers are being developed in order to predict the
load’s consumption and decide whether the process should be
enabled or not.
The purpose of this work is adapting a solar energy harvesting
circuit to supply the EPOSMoteII and, simultaneously,
improve the EPOS’s (Embedded Parallel Operating System)
energy scheduler by providing battery and environmental
prediction information. This work evaluates the harvester
circuit, showing its capability of improving the EPOSMoteII
longevity. Besides that, the work also discusses the performance
improvements of EPOS’ energy scheduler [3] by using
the developed circuit.

Table I
POWER DENSITIES OF HARVESTING TECHNOLOGIES
Harvesting technology Power density
Solar cells (outdoors at noon) 15mW=cm2
Piezoelectric (shoe inserts) 330W=cm3
Vibration (small microwave oven) 116W=cm3
Thermoelectric (10C gradient) 40W=cm3
Acoustic noise (100dB) 330nW=cm3

The paper is organized as follows. The related work is
presented in section II. Section III presents the harvester circuit
design, focusing on the adaptions made to provide energy to
EPOSMoteII. Section IV shows the results concerning the
energy capability of the harvester circuit. Section IV brings
a discussion about the improvements in providing the battery
information to EPOS’ energy scheduler. Finally, section VI
concludes the paper.

II. RELATED WORK
A. Solar Energy Usage
One of the main topics of research in wireless sensor
networks is the energy consumption reduction. Normally the
sensors are powered by batteries, which have limited capacity.
Solutions as sleeping modes or low power communication
protocols [4] are recently being studied. Although these solutions
extend the node’s lifetime, they only distribute better the
battery’s amount of energy along the network. Therefore, the
idea of energy harvesting has being applied in order to deliver
more energy to the nodes. Table I shows different harvesting
technologies and their power densities [1].
As shown in Table I, the solar modality presents the highest
power density. However, many parameters should be taken into
account when planning to operate a PV module. Examples of
these parameters are: solar irradiation, temperature variation,
mechanical position, PV module electrical characteristics etc.
Normally photovoltaic cells are tested under specific conditions
(temperature of 25C and an irradiance of 1000 W=m2)
from which typical curves are extracted. Figure 1 shows these
curves.
This curve shows the relation between the voltage and
the current in a polycrystalline silicon cell. It demonstrates
that solar cells are very versatile. They can operate from
the state of open circuit (theoretically no current flowing)
to the state of short circuit (theoretically no voltage drop
between solar cell positive and negative terminals). The solar

2
Figure 1. Typical solar cell voltage-current and power-voltage curves

cell power curve is nothing but the product of voltage and
current values in y and x axis. With this concept in mind, and
assuming positive values for voltage and current, the power
curve must have at least one maximum value, as shown in
Figure 1. In order to extract the maximum power of the
environment, a solar panel must operate as close as possible
to this maximum power point. Normally, the maximum power
is extracted from the solar panel by applying to it the VMPP
(voltage at maximum power point). There are several ways of
achieving this goal. Electronic circuits, denominated maximum
power point trackers (MPPT), are responsible for ensuring the
operation on this point.
The idea of operating a solar panel as close as possible to its
VMPP is not new [5]. The microelectronic industry has already
developed integrated circuits able to keep the solar panel
under VMPP . Unfortunately, most of these IC’s are dedicated
to high power applications and their power consumption are
not compatible with energy harvesting systems. Therefore,
MPPT circuits for low power application are being studied.
The goal of these circuits is to detect changes on the solar
panel, calculate the new VMPP and impose this voltage on
the PV module. The PV module behavior changes are caused
mainly by temperature and solar irradiation variations, which
demands sensors to evaluate their state changes. These sensors
are loads in the system and normally are not the solution to
energy consumption reduction.
In order to solve this problem, the research was led to electronic
circuits that are able to extract the solar cell information
directly from its electrical characteristics. Methods as Perturb
and Observe [6], [7], Incremental Conductance [8], [9],
Fractional Open Circuit Voltage [10], [11] Constant Voltage
[12] are the most well-known. Although these are interesting
methods, the solution described here is focused on working
as close as possible to the MPP through an ideal matching
between the battery and the PV module. This is the simplest
way of operating a solar panel closely to its MPPT. Even
though it is not the most efficient method, its efficiency for
harvesting circuits have already been proved [2]. Besides its
simplicity, this circuit provides accurate battery information to
the EPOSMoteII energy scheduler, which allowed a significant
improvement in its structure.
B. EPOSMoteII Consumption Considerations
Since this work is strongly related with the energy consumption
of EPOSMoteII, it is convenient to elucidate the
actual method implemented for estimating its consumption and
how it can be improved. The actual method, Battery Level
Monitoring by Event Accounting [3], estimates the battery
level by the following equations:

,where Etm(dev) is the energy consumption in the timebased
profile for a specific device, tend and tbegin denote
timestamps, and I is the current of dev at a given mode. Eev
denotes the sum of energy (Ei) consumed by the observed
events (counters). Etot is the energy consumption in the
combined profile.
The idea is to estimate the energy consumed by the EPOSMoteII
devices through two different perspectives. The first
one is dedicated to devices operating with constant current
during a limited period of time, in a specific mode (Equation
1). The second perspective is an event-based (e.g., sensor
sampling) described by Equation 2. Finally, the total consumed
energy is given by Equation 3, where Etm(dev) and Eev(dev)
are summed. The inputs for equations 1 and 2 (Idev;mode and
Ei) are based on information given by the components’ manufacturer,
therefore, it is a pessimistic but safety estimation. In
order to avoid underestimations by considering the worst case,
a battery voltage measurement is done from time to time. With
this voltage it is also possible to estimate the battery energy.
The battery energy (Ebatt) is then given by:

,where Evolt is the battery energy estimation based on
the battery voltage measurement realized by the EPOSMoteII
ADC. The drawback of this method is the energy consumption,
since the battery voltage is measured through and shunt resistor.
This is the reason why the measurements are done only
from time to time. Hence, the main contribution of this work is
not only providing energy to EPOSMoteII through a harvesting
circuit but, with the same circuit, allowing an improvement
on the scheduler. The idea is replacing the Evolt by the value
received from the battery monitor IC, which is more accurate.
Besides that, the measurement may be realized with a higher
frequency, since these measurements are supported by the

3
power coming from the solar panels. It is known that there
are more efficient circuits using MPPT techniques [13], [14],
however, none of these works provide a solution with energy
harvesting and energy schedulers simultaneously. Besides that,
the results of this work are meant to be compared with MPPT
circuits to be developed to EPOSMoteII, in order to explore
whether/when MPPT circuits are more suitable.

III. DESIGN CONSIDERATIONS
This section is dedicated to explain how the harvester circuit
was designed. It presents discussions about the decisions and
the modifications implemented on Heliomote [2], from UCLA,
in order to develop a solar harvester circuit to EPOSMoteII.

A. Solar Cell and Energy Storage Unit
The relation between the solar cell and the energy storage
unit is the most important issue of this harvester circuit. The
reason for that is the need of working as close as possible to
the MPP, in order to extract the maximum amount of energy
available. Since the circuit has no maximum power point
tracker (the solar cells are directly coupled to the battery),
the battery operating voltage should be as close as possible to
the VMPP for the selected solar cell. The two available technologies
to store energy, in a rechargeable way, are batteries
and super capacitors. Although the capacitors’ technologies
have been improving, super capacitors are not recommended
for solar harvesting circuits yet due to intrinsic leakage, losses
on parasitic paths in the external circuitry [2] and low energy
density. Among all the battery technologies available (e.g.,
Sealed Lead Acid, Nickel Cadmium, Nickel Metal Hydride,
Lithium based) the Nickel Metal Hydride (NiMH) was chosen.
The main reasons for this choice were the low complexity
on the recharging circuit and the absence of memory effect.
Consequently, the system is powered by two common AA
NiMH batteries with nominal charge capacity of 2100mA.
The PV module is composed by two 4V-100mA solar cells
measuring 60 x 60mm. The solar cell’s characterization curves
were plotted (Figures 2 and 3) based on data collected outside,
on March 08, 2012 at 1:15 PM. The goal of the test was to
find out the open circuit voltage (VOC), the short circuit current
(ISC) and the VMPP . Table II shows the measured values.

Figure 2. Solar panel characterization carried outside - current-voltage curve

Figure 3. Solar panel characterization carried outside - power-voltage curve

Table II
SOLAR PANEL MEASURED PARAMETERS
Parameter Measured Value
VOC 4.15V
ISC 122.3mA
VMPP 3.25V

B. Adaptation to EPOSMoteII
In order to understand the next changes proposed by this
work, it is interesting to comprehend the EPOSMoteII characteristics.
The EPOSMoteII is a modular hardware developed
around Freescale MC13224V, which is a Platform-in-Package
based on a 32-bit ARM7 core, containing a 2.4 GHz radiofrequency
transceiver. The mote’s modular feature allows it to be
stacked with startup boards which may have different kinds of
sensors. The main reason for changing Heliomote’s circuit is
that the MC13224V has its own buck converter inside. The
buck converter input voltage range is from 2.0V to 3.6V. The
voltage is than down converted to 1.8V. This implies in not
using the voltage regulator proposed in Heliomote’s project,
improving the harvester circuit efficiency.

C. Circuit Design
The harvester circuit is planned to charge the NiMH batteries
until a predefined threshold voltage. This voltage is set
by external resistors in a voltage monitor (ICL7665). The
threshold voltage selected was based on the charge behavior
of the NiMH battery provided by the manufacturer [15] (see
Figure 4). This battery is considered fully charged when
reaches a voltage around 1.45V (0.1C curve). The selected
threshold voltage was 2.9V since two AA cells in series
were used. After reaching this value, the solar panel is short
circuited to ground through an analog switch. This switch is
controlled by the overvoltage signal provided by the ICL7665.
This action prevents the battery of being overcharged. A
normally opened (MAX4614) analog switch were used instead
of a normally closed one. Therefore, if the initial battery
voltage is bellow 2V it will be charged by the solar panel
instead of being short circuited to the ground as in the case of
using a normally closed one. The circuit also must take care
of the undercharge situation. There are two different reasons
to avoid that. First of all, there is a minimum voltage threshold
from which batteries do not operate properly. In this case it is

4
recommended to disconnect the load in order to avoid battery
degradation. The second reason is that the input voltage of the
Freescale MC13224V buck converter should not be lower than
2V. Thus, the under voltage pin of the ICL7665 is connected
to a transistor. Then, when the battery voltage drops below
2.1V the transistor is opened, disconnecting the EPOSMoteII.
A simplified block diagram of the harvester circuit is shown in
Figure 5. Besides the already mentioned features, the circuit
has a battery monitor (DS2438), which is a fundamental part of
the circuit. This IC provides the battery’s information (battery
voltage, battery current, remaining capacity, temperature etc.)
that are used by the EPOSMoteII energy scheduler. The
DS2438 also has an integrated current accumulator, which
informs the total current going in and out of the battery. This
IC uses a specific communication protocol named 1-Wire.
The Freescale MC13224V has no internal dedicated hardware
for this protocol therefore, a customized software driver was
developed. This software was written specifically for EPOS,
in a generic way, providing to the EPOS’ user the possibility
of communicating with any 1-Wire
R device through a high
level interface.

Figure 4. Charging curves for AA Nickel Metal Hidryde battery.

Figure 5. Simplified block diagram of the EPOSMote II solar harvester
circuit.

IV. HARVESTER CIRCUIT EVALUATION
In order to test the harvester circuit capability the system
was monitored during 62h45min. The radio emitted information
in a duty cycle of 100%. This uncommonly used high duty
cycle was due to the intention of realize the test in a reduced
period of time. Otherwise, we would need to extend the tests
for several weeks, since the total power consumption when the
radio is transmitting is only 30mW. Figure 6 shows the voltage
behaviour during the test. In both cycles the battery has almost
reached the fully recharged voltage. The system has shown its
capability of being quasi-self-sufficient. The harvester circuit
is able to provide enough energy to the batteries until they are

Figure 6. Battery voltage behavior.

Figure 7. Current delivered by the solar panel.

Figure 8. Solar irradiance variation.

Figure 9. Relation between current and solar radiation .

Figure 10. Temperature variation.

V. CASE STUDY

VI. CONCLUSION
Embedded system energy constraints have motivated this
work. The solution purposed for this problem was based
on solar energy harvesting. Therefore, we have adapted an
energy harvester circuit to our specific mote (EPOSMoteII),
proving its quasi-self-sufficient characteristic by experimental
tests. We also improved the energy scheduler by providing to
the operating system more accurate battery information. We
evaluated the modified scheduler comparing the results with
the original one, proving the expected improvement. Finally,
we suggest that MPPT circuits may be more efficient and
feasible to our specific application, which is a motivation to
future works.

REFERENCES
[1] S. Roundy, “Energy scavenging for wireless sensor nodes with a focus on
vibration to electricity conversion,” Ph.D. dissertation, Dept. of EECS,
UC Berkeley, May 2003.
[2] V. Raghunathan, A. Kansal, J. Hsu, J. Friedman, and M. Srivastava,
“Design considerations for solar energy harvesting wireless embedded
systems,” in Proceedings of the Fourth International Symposium on
Information Processing in Sensor Networks, IPSN 2005, April 2005,
pp. 457 – 462.
[3] A. J. Hoeller and A. A. Fr¨ohlich, “On the monitoring of systemlevel
energy consumption of battery-powered embedded systems,” in
Proceedings of the 2011 IEEE International Conference on Systems,
Man, and Cybernetics, Anchorage, AK, USA, 2011.
[4] V. Raghunathan, S. Ganeriwal, and M. Srivastava, “Emerging techniques
for long lived wireless sensor networks,” Communications Magazine,
IEEE, vol. 44, no. 4, pp. 108 – 114, April 2006.
[5] J. Schoeman and J. van Wyk, “A simplified maximal power controller
for terrestrial photovoltaic panel arrays,” in Proceedings of 13th Annual
IEEE Power Electronics Specialists Conference, PESC-82, June 1982,
pp. 361 – 367.
[6] X. Liu and L. Lopes, “An improved perturbation and observation
maximum power point tracking algorithm for pv arrays,” in IEEE 35th
Annual Power Electronics Specialists Conference, PESC 04, vol. 3, June
2004, pp. 2005 – 2010.
[7] C. W. Tan, T. Green, and C. Hernandez-Aramburo, “Analysis of perturb
and observe maximum power point tracking algorithm for photovoltaic
applications,” in IEEE 2nd International Power and Energy Conference,
PECon 2008, December 2008, pp. 237 –242.
[8] S. Jain and V. Agarwal, “A new algorithm for rapid tracking of
approximate maximum power point in photovoltaic systems,” Power
Electronics Letters, IEEE, vol. 2, no. 1, pp. 16 – 19, March 2004.
[9] S. Qin, M. Wang, T. Chen, and X. Yao, “Comparative analysis of
incremental conductance and perturb-and-observation methods to implement
mppt in photovoltaic system,” in 2011 International Conference
on Electrical and Control Engineering (ICECE), September 2011, pp.
5792 –5795.
[10] J. Ahmad, “A fractional open circuit voltage based maximum power
point tracker for photovoltaic arrays,” in 2nd International Conference
on Software Technology and Engineering (ICSTE), vol. 1, October 2010,
pp. 247 – 250.
[11] D. Dondi, A. Bertacchini, L. Larcher, P. Pavan, D. Brunelli, and
L. Benini, “A solar energy harvesting circuit for low power applications,”
in IEEE International Conference on Sustainable Energy Technologies,
ICSET 2008, November 2008, pp. 945 –949.
[12] G. Yu, Y. Jung, J. Choi, I. Choy, J. Song, and G. Kim, “A novel twomode
mppt control algorithm based on comparative study of existing
algorithms,” in Conference Record of the Twenty-Ninth IEEE Photovoltaic
Specialists Conference, May 2002, pp. 1531 – 1534.
[13] O. Lopez-Lapena, M. Penella, and M. Gasulla, “A new mppt method
for low-power solar energy harvesting,” IEEE Transactions on Industrial
Electronics, vol. 57, no. 9, pp. 3129 – 3138, September 2010.
[14] K. K. Win, X. Wu, S. Dasgupta, W. J. Wen, R. Kumar, and S. Panda,
“Efficient solar energy harvester for wireless sensor nodes,” in 2010
IEEE International Conference on Communication Systems (ICCS),
November 2010, pp. 289 – 294.
[15] Panasonic, Nickel metal hydride handbook, August 2000.
